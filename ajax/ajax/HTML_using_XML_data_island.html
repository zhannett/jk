<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<title>XML Data Island Test</title>
		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
		<style type="text/css">
			xml {display:none; font-size:0px}
		</style>
		<script type="text/javascript">
			try {
					var x = new DOMParser();
					var _IE = false;
			}
			catch(e) {var _IE = true;};
			
			var _URL = 'http://www.janetkulyk.com/ajax/ajax/sampleXML.xml';
			var _XMLHTTP;
		</script>
	</head>
	
	<body>
		<script type="text/javascript">initialize()</script>
		<xml id="xmlDI"></xml>
		<strong>XML Data Island Test</strong><br/>
		<div id="show"></div>		
		
		<script type="text/javascript">
			/* Perform page initialization */
			function initialize() {
					if(_IE) _XMLHTTP = new ActiveXObject('Microsoft.XMLHTTP');
					else _XMLHTTP = new XMLHTTPRequest();
					
					_XMLHTTP.onreadystatechange = stateChangeHandler;
					
					_XMLHTTP.open('GET',_URL,true);  // Asynchronous (true)
					_XMLHTTP.send(null);
			}
			
			/* Handle the asynchronous response to a XMLHTTPRequest, including the loading of the XML Data Island */
			function stateChangeHandler() {
					if(_XMLHTTP.readyState == 4) {
							var strHTML = '';
							var nodeCount;
						
							if(_IE) {
									document.getElementById('xmlDI').XMLDocument.load(_XMLHTTP.responseXML);
									nodeCount = document.getElementById('xmlDI').XMLDocument.getElementsByTagName('state_name').length;
							} else {
									document.getElementById('xmlDI').innerHTML = _XMLHTTP.responseText;
									nodeCount = document.body.getElementsByTagName('state_name').length;
							}
						
							try {
									_XMLHTTP.close();   // Close XMLHttpRequest
							}
							catch(e) {}
						
							for (var i=0; i < nodeCount; i++) strHTML += '<div xmldi="xmlDI" xmlnode="state_name"></div>';								
							document.getElementById('show').innerHTML = strHTML;				
							alert(document.getElementById('show').innerHTML);			
							_bind();      // Bind XML and HTML
					}
			}		
		
		/*
		Handle the logic necessary to bind HTML elements to XML nodes. 
		Note that in some instances this binding is a two-way street. 
		For example, if the value in a text box should change 
		the corresponding value in the XML data island will also change. 
		*/
		function _bind() {
				if(arguments.length == 0) {
						doBind(document.body.getElementsByTagName('div'));
						doBind(document.body.getElementsByTagName('input'));
						doBind(document.body.getElementsByTagName('select'));
						doBind(document.body.getElementsByTagName('span'));
						doBind(document.body.getElementsByTagName('textarea'));			
				} else {
						applyChange(arguments[0],arguments[1]);
						_bind();  //Re-bind
				}		
		}
		/*
			To handle data-binds for specific nodes based upon HTML element type and browser type.
		*/
		function doBind(objects) {
				var strTag;     // HTML tag
				var strDI;      // XML data island id
				var strNode;    //XML node name
				var strValue;   //XML node value
				
				for (var i=0;i < objects.length;i++) {
						strTag = objects[i].tagName;
						strDI = objects[i].getAttribute('xmldi');
						strNode = objects[i].getAttribute('xmlnode');
					
						if(strDI != null && strNode != null) {
					
								if(_IE) strValue = document.getElementById(strDI).XMLDocument.selectNodes('//' + strNode).item(i).text;
								else strValue = document.getElementById(strDI).getElementsByTagName(strNode)[i].innerHTML;
										
								switch(strTag) {
										case('div'):
										case('span'):
												objects[i].innerHTML = strValue;
												break;
										case('input'):
												switch(objects[i].type) {
														case ('text'):
														case('hidden'):
														case('password'):
																objects[i].value = strValue;
																objects[i].onchange = new Function("_bind(this, " + i.toString() + ")");
																break;
														case('checkbox'):
																if(objects[i].value == strValue) 
																		objects[i].checked = true;
																else
																		objects[i].checked = false;																
																objects[i].onclick = new Function("_bind(this," + i.toString() + ")");
																break;						
														case('radio'):
																if(_IE) 
																		strValue = document.getelementById(strDI).XMLDocument.selectNodes('//' + strNode).item(0).text;
																else 
																		strValue = document.getElementById(strDI).getElementsByTagName(strNode)[0].innerHTML;
															
																if(objects[i].value == strValue) 
																		objects[i].checked = true;
																else 
																		objects[i].checked = false;														
																objects[i].onclick = new Function("_bind(this,0)");
																break;
												}
												break;
										case('select'):
										case('textarea'):
												objects[i].value = strValue;
												objects[i].onchange = new Function("_bind(this," + i.toString() + ")");
												break;
								}		// end switch		
						}   // end if
				}   // end for
		}   // end function
		
		/*
			To handle changes to the bound HTML elements and apply those changes to the appropriate XML node.
		*/
		function applyChange(obj,index) {
				var strDI = obj.getAttribute('xmldi');
				var strNode = obj.getAttribute('xmlnode');
				var strValue = obj.value;
			
				if (obj.type == 'checkbox')
						if (obj.checked) strValue = obj.value;
						else strValue = '';					
				if (_IE) document.getelEmentById(strDI).XMLDocument.selectNodes('//' + strNode).item(index).text = strValue;
				else document.getElementById(strDI).getElementsByTagName(strNode)[index].innerHTML = strValue;
		}		
		</script>		
	</body>
</html>